// SparkPoint | Red Cross Batch Export Script (always asks for destination folder)

if (app.documents.length > 0) {
    var doc = app.activeDocument;
    var docName = "WRC_RedCross_4col_Ad";

    // Always ask for a folder
    var folderPath = Folder.selectDialog("Select folder to save exported files");
    if (!folderPath) {
        alert("Export canceled. No folder was selected.");
        throw new Error("No folder selected.");
    }

    // --- 1. Save a webp proof copy (for approval) ---
    try {
        var webpFile = new File(folderPath + "/" + docName + "_PROOF.webp");
        var webpOptions = new ExportOptionsSaveForWeb();
        webpOptions.format = SaveDocumentType.WEBP;
        webpOptions.includeProfile = false;
        webpOptions.interlaced = false;
        webpOptions.quality = 85;
        doc.exportDocument(webpFile, ExportType.SAVEFORWEB, webpOptions);
    } catch(e) {
        alert("WebP export failed: You may need to install the WebP plugin or use a newer Photoshop version.");
    }

    // --- 2. Save a PDF for print ---
    var pdfFile = new File(folderPath + "/" + docName + "_PRINT.pdf");
    var pdfSaveOptions = new PDFSaveOptions();
    pdfSaveOptions.preserveEditability = false;
    pdfSaveOptions.optimization = true;
    pdfSaveOptions.quality = 12;
    doc.saveAs(pdfFile, pdfSaveOptions, true);

    // --- 3. Save a TIFF for print ---
    var tiffFile = new File(folderPath + "/" + docName + "_PRINT.tif");
    var tiffSaveOptions = new TiffSaveOptions();
    tiffSaveOptions.imageCompression = TIFFEncoding.NONE;
    tiffSaveOptions.layers = false;
    doc.saveAs(tiffFile, tiffSaveOptions, true);

    // --- 4. Save a JPEG for print ---
    var jpegFile = new File(folderPath + "/" + docName + "_PRINT.jpg");
    var jpegSaveOptions = new JPEGSaveOptions();
    jpegSaveOptions.quality = 12;
    doc.saveAs(jpegFile, jpegSaveOptions, true);

    alert("Saved as:\n"
        + "- " + docName + "_PROOF.webp\n"
        + "- " + docName + "_PRINT.pdf\n"
        + "- " + docName + "_PRINT.tif\n"
        + "- " + docName + "_PRINT.jpg\n\n"
        + "All files saved to:\n" + folderPath.fsName
    );
} else {
    alert("No document open!");
}
